# Менеджеры пакетов

## Нумерация версий ПО

**Программная библиотека** – контролируемая коллекция программных приложений и связанной с ними документации, предназначенная для использования в процессе разработки, эксплуатации и сопровождения программного обеспечения.

Библиотеки, модули, пакеты, расширения – элементы программных приложений, которые предназначены для модульной организации программы и повторного использования кода.

Существуют различные схемы нумерации версий:

* последовательные значения,
* по дате выпуска,
* различные экзотические схемы (TeX и проч.).

Указание стадии разработки в версии:

* начальная стадия разработки – альфа (например, 1.2.0-alpha.1),
* Стадия тестирования и отладки – бета (например, 1.2.0-beta),
* Выпуск-кандидат (например, 1.2.0-rc.3),
* Публичный выпуск (например, 1.2.0),
* Исправления после выпуска (1.2.5).
  
**Ад зависимостей** – проблема управления программными пакетами (библиотеками, модулями), которые зависят от определенных версий других программных пакетов.

В сложных случаях различные установленные программные продукты требуют наличия разных версий одной и той же библиотеки. В наиболее сложных случаях один продукт может косвенно требовать сразу две версии одной и той же библиотеки. Проблемы с зависимостями возникают у общих пакетов/библиотек, у которых некоторые другие пакеты имеют зависимости от несовместимых и различных версий общих пакетов.

Без формальной спецификации номера версий практически бесполезны для управления зависимостями. Ясно определив и сформулировав идею версионирования, становится легче сообщать о намерениях пользователям ПО.

В настоящее время популярность приобрела схема семантической нумерации версий @fig:pm1.

![Семантическая нумерация версий](pm1.png){#fig:pm1}

Учитывая номер версии МАЖОРНАЯ.МИНОРНАЯ.ПАТЧ, следует увеличивать:

1. МАЖОРНУЮ версию, когда сделаны обратно несовместимые изменения API.
1. МИНОРНУЮ версию, когда вы добавляете новую функциональность, не нарушая обратной совместимости.
1. ПАТЧ-версию, когда вы делаете обратно совместимые исправления.

Дополнительные обозначения для предрелизных и билд-метаданных возможны как дополнения к МАЖОРНАЯ.МИНОРНАЯ.ПАТЧ формату.

Обычный номер версии ДОЛЖЕН иметь формат X.Y.Z, где X, Y и Z – неотрицательные целые числа и НЕ ДОЛЖНЫ начинаться с нуля. X – мажорная версия, Y – минорная версия и Z – патч-версия. Каждый элемент ДОЛЖЕН увеличиваться численно. Например: 1.9.0 -> 1.10.0 -> 1.11.0.

После релиза новой версии пакета содержание этой версии НЕ ДОЛЖНО быть модифицировано. Любые изменения ДОЛЖНЫ быть выпущены как новая версия.

**Мажорная версия** X (X.y.z | X > 0) ДОЛЖНА быть увеличена, если в публичном API представлены какие-либо обратно несовместимые изменения. Она МОЖЕТ включать в себя изменения, характерные для уровня минорных версий и патчей. Когда увеличивается мажорная версия, минорная и патч-версия ДОЛЖНЫ быть обнулены.

Мажорная версия ноль (0.y.z) предназначена для начальной разработки. Всё может измениться в любой момент. Публичный API не должен рассматриваться как стабильный.

**Минорная версия** (x.Y.z | x > 0) ДОЛЖНА быть увеличена, если в публичном API представлена новая обратно совместимая функциональность. Версия ДОЛЖНА быть увеличена, если какая-либо функциональность публичного API помечена как устаревшая (deprecated). Версия МОЖЕТ быть увеличена в случае реализации новой функциональности или существенного усовершенствования в приватном коде. Версия МОЖЕТ включать в себя изменения, характерные для патчей. Патч-версия ДОЛЖНА быть обнулена, когда увеличивается минорная версия.

**Патч-версия Z** (x.y.Z | x > 0) ДОЛЖНА быть увеличена только если содержит обратно совместимые баг-фиксы. Определение баг-фикс означает внутренние изменения, которые исправляют некорректное поведение.

Приоритет определяет, как версии соотносятся друг с другом, когда упорядочиваются. Приоритет версий ДОЛЖЕН рассчитываться путем разделения номеров версий на мажорную, минорную, патч и предрелизные идентификаторы. Приоритет определяется по первому отличию при сравнении каждого из этих идентификаторов слева направо: Мажорная, минорная и патч-версия всегда сравниваются численно. Пример: 1.0.0 < 2.0.0 < 2.1.0 < 2.1.1. Когда мажорная, минорная и патч-версия равны, предрелизная версия имеет более низкий приоритет, чем нормальная версия.

## Управление пакетами

Менеджер пакетов – ПО для управления процессом установки, удаления, настройки и обновления различных компонентов программного обеспечения. Менеджеры пакетов бывают следующих видов:

* уровня ОС (например, RPM в Linux),
* уровня языка программирования (например, npm для JavaScript),
* уровня приложения (например, Package Control для Sublime Text, управление плагинами для Eclipse).

Пакет содержит в некотором сжатом файловом формате  программный код и метаданные. К метаданным относятся:

* указание авторства, версии и описание пакета,
* список зависимостей пакета,
* хэш-значение содержимого пакета.
* 
Пример метаданных из пакета для npm (JavaScript):

```javascript
{
  "name": "my_package",
  "version": "1.0.0",
  "dependencies": {
    "my_dep": "^1.0.0",
    "another_dep": "~2.2.0"
  }
}
```

Пример метаданных из пакета для NuGet (.NET):

```xml 
<?xml version="1.0" encoding="utf-8"?>
<package xmlns="http://schemas.microsoft.com/packaging/2010/07/nuspec.xsd">
    <metadata>
        <id>sample</id>
        <version>1.0.0</version>
        <authors>Microsoft</authors>
        <dependencies>
            <dependency id="another-package" version="3.0.0" />
            <dependency id="yet-another-package" version="1.0.0" />
        </dependencies>
    </metadata>
</package>
```

Пример метаданных из пакета для Maven (Java):

```xml 
<project xmlns="http://maven.apache.org/POM/4.0.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
                      https://maven.apache.org/xsd/maven-4.0.0.xsd">
  ...
  <dependencies>
    <dependency>
      <groupId>junit</groupId>
      <artifactId>junit</artifactId>
      <version>4.12</version>
      <type>jar</type>
      <scope>test</scope>
      <optional>true</optional>
    </dependency>
    ...
  </dependencies>
  ...
</project>
```

Пример проблемы с зависимостями пакетов – ромбовидная зависимость, см. @fig:pm2.

Пакет A нуждается в пакетах B и C. B нужна версия 1 пакета D, а не версия 2. C требует D версии 2, а не версии 1. В этом случае, если предположить, что невозможно выбрать обе версии D, нет возможности построить A.

![Пример ромбовидной зависимости между пакетами](pm2.png){#fig:pm2}

В общем случае задача разрешения зависимостей между пакетами является NP-полной. Для ее решения сегодня применяются SAT-решатели.
